/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package com.jobits.pos.ui.venta.orden;

import com.jgoodies.binding.adapter.Bindings;
import com.jgoodies.binding.list.SelectionInList;
import com.jgoodies.binding.value.ValueModel;
import com.jobits.ui.components.MaterialComponentsFactory;
import com.jobits.ui.components.swing.containers.TaskButton;
import java.awt.AlphaComposite;
import java.awt.Component;
import java.awt.Graphics2D;
import java.awt.RenderingHints;
import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.imageio.ImageIO;
import javax.swing.Action;
import javax.swing.ImageIcon;
import javax.swing.JLabel;
import com.jhw.swing.material.standars.MaterialIcons;
import java.awt.Color;
import java.util.ArrayList;
import java.util.List;
import com.jobits.pos.domain.models.ProductovOrden;
import com.jobits.pos.ui.AbstractViewPanel;
import com.jobits.pos.ui.presenters.AbstractViewPresenter;
import com.jobits.pos.ui.utils.ListCellRenderPedido;
import static com.jobits.pos.ui.venta.orden.presenter.OrdenDetailViewModel.*;
import static com.jobits.pos.ui.venta.orden.presenter.OrdenDetailViewPresenter.*;
import java.awt.Point;
import java.awt.Rectangle;
import java.awt.event.ActionEvent;
import javax.swing.JList;
import javax.swing.SwingConstants;

/**
 *
 * @author Home
 */
public class PedidoCardView extends AbstractViewPanel {

    String imageURL, title, secondaryText, mediaURL, supportText;
    Action mainButtonAction, secundaryButtonAction;
    ValueModel valueModelTitle, valueModelSecundaryText;
    List<Action> menuActionsList = new ArrayList<>();

    public PedidoCardView(AbstractViewPresenter presenter) {
        super(presenter);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        jPanelHeader = new javax.swing.JPanel();
        jPanelEstado = new javax.swing.JPanel();
        jLabelTerminada = new javax.swing.JLabel();
        jLabelPorciento = new javax.swing.JLabel();
        jLabelGratis = new javax.swing.JLabel();
        jPanel2 = new javax.swing.JPanel();
        jLabelOrdenNo = MaterialComponentsFactory.Displayers.getH3Label();
        jLabelMesa = MaterialComponentsFactory.Displayers.getLabel();
        jPanelMenu = new javax.swing.JPanel();
        jButtonMenu = new javax.swing.JButton();
        jToggleButtonExpand = new javax.swing.JToggleButton();
        jPanelMedia = new javax.swing.JPanel();
        jScrollPane1 = new javax.swing.JScrollPane();
        jList1 = new javax.swing.JList<>()
        ;
        jPanelSupportText = new javax.swing.JPanel();
        jPanel4 = new javax.swing.JPanel();
        jLabel7 = new javax.swing.JLabel();
        jLabelVALORHora = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        jLabelVALORUsuario = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jLabelVALORTotal = new javax.swing.JLabel();
        jPanelActionButtons = new javax.swing.JPanel();
        jideButtonEnviarCocina = MaterialComponentsFactory.Buttons.getOutlinedButton();
        jideButtonCerrarMesa = MaterialComponentsFactory.Buttons.getMaterialButton();

        setBorder(new javax.swing.border.LineBorder(new java.awt.Color(153, 153, 153), 2, true));
        setToolTipText(null);
        setMaximumSize(new java.awt.Dimension(32773, 500));
        setMinimumSize(new java.awt.Dimension(300, 500));
        setPreferredSize(new java.awt.Dimension(300, 500));
        setSize(new java.awt.Dimension(300, 500));
        setLayout(new javax.swing.BoxLayout(this, javax.swing.BoxLayout.PAGE_AXIS));

        jPanelHeader.setBorder(javax.swing.BorderFactory.createEmptyBorder(10, 10, 3, 10));
        jPanelHeader.setToolTipText(null);
        jPanelHeader.setMaximumSize(new java.awt.Dimension(400, 80));
        jPanelHeader.setMinimumSize(new java.awt.Dimension(20, 80));
        jPanelHeader.setPreferredSize(new java.awt.Dimension(80, 80));
        jPanelHeader.setLayout(new java.awt.BorderLayout());

        jPanelEstado.setToolTipText(null);
        jPanelEstado.setMaximumSize(new java.awt.Dimension(25, 200));
        jPanelEstado.setMinimumSize(new java.awt.Dimension(0, 60));
        jPanelEstado.setPreferredSize(new java.awt.Dimension(30, 80));
        jPanelEstado.setLayout(new java.awt.GridLayout(3, 0));

        jLabelTerminada.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabelTerminada.setIcon(new javax.swing.ImageIcon(getClass().getResource("/restManager/resources/images/icons8-checkmark.png"))); // NOI18N
        jLabelTerminada.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jPanelEstado.add(jLabelTerminada);

        jLabelPorciento.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabelPorciento.setIcon(new javax.swing.ImageIcon(getClass().getResource("/restManager/resources/images/icons8-percentage.png"))); // NOI18N
        jLabelPorciento.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jPanelEstado.add(jLabelPorciento);

        jLabelGratis.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabelGratis.setIcon(new javax.swing.ImageIcon(getClass().getResource("/restManager/resources/images/icons8-gratis-negro.png"))); // NOI18N
        jLabelGratis.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jPanelEstado.add(jLabelGratis);

        jPanelHeader.add(jPanelEstado, java.awt.BorderLayout.WEST);

        jPanel2.setBorder(javax.swing.BorderFactory.createEmptyBorder(1, 10, 1, 1));
        jPanel2.setToolTipText(null);
        jPanel2.setMaximumSize(new java.awt.Dimension(30000, 30000));
        jPanel2.setMinimumSize(new java.awt.Dimension(150, 40));
        jPanel2.setPreferredSize(new java.awt.Dimension(200, 40));
        jPanel2.setLayout(new java.awt.GridLayout(2, 1, 0, 5));

        jLabelOrdenNo.setFont(new java.awt.Font("Dialog", 1, 14)); // NOI18N
        jLabelOrdenNo.setText("<No Orden>");
        jLabelOrdenNo.setToolTipText(null);
        jLabelOrdenNo.setMaximumSize(new java.awt.Dimension(3000, 3000));
        jLabelOrdenNo.setMinimumSize(new java.awt.Dimension(20, 25));
        jLabelOrdenNo.setPreferredSize(new java.awt.Dimension(20, 25));
        jPanel2.add(jLabelOrdenNo);

        jLabelMesa.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
        jLabelMesa.setText("<Mesa>");
        jLabelMesa.setToolTipText(null);
        jLabelMesa.setMaximumSize(new java.awt.Dimension(3000, 3000));
        jLabelMesa.setMinimumSize(new java.awt.Dimension(20, 16));
        jLabelMesa.setPreferredSize(new java.awt.Dimension(20, 16));
        jPanel2.add(jLabelMesa);

        jPanelHeader.add(jPanel2, java.awt.BorderLayout.CENTER);

        jPanelMenu.setToolTipText(null);
        jPanelMenu.setMaximumSize(new java.awt.Dimension(20, 20));
        jPanelMenu.setPreferredSize(new java.awt.Dimension(20, 20));
        jPanelMenu.setLayout(new java.awt.GridLayout(2, 1));

        jButtonMenu.setBackground(jPanelHeader.getBackground());
        jButtonMenu.setForeground(jPanelHeader.getBackground());
        jButtonMenu.setIcon(MaterialIcons.MORE_VERT);
        jButtonMenu.setToolTipText(null);
        jButtonMenu.setFocusPainted(false);
        jButtonMenu.setMaximumSize(new java.awt.Dimension(20, 10));
        jButtonMenu.setMinimumSize(new java.awt.Dimension(20, 10));
        jButtonMenu.setPreferredSize(new java.awt.Dimension(20, 10));
        jButtonMenu.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonMenuActionPerformed(evt);
            }
        });
        jPanelMenu.add(jButtonMenu);

        jToggleButtonExpand.setIcon(new javax.swing.ImageIcon(getClass().getResource("/restManager/resources/images/icons8-expand_arrow.png"))); // NOI18N
        jToggleButtonExpand.setSelected(true);
        jToggleButtonExpand.setBorderPainted(false);
        jToggleButtonExpand.setContentAreaFilled(false);
        jToggleButtonExpand.setEnabled(false);
        jToggleButtonExpand.setPreferredSize(new java.awt.Dimension(18, 18));
        jToggleButtonExpand.setSelectedIcon(new javax.swing.ImageIcon(getClass().getResource("/restManager/resources/images/icons8-collapse_arrow.png"))); // NOI18N
        jPanelMenu.add(jToggleButtonExpand);

        jPanelHeader.add(jPanelMenu, java.awt.BorderLayout.EAST);

        add(jPanelHeader);

        jPanelMedia.setToolTipText(null);
        jPanelMedia.setMaximumSize(new java.awt.Dimension(600, 200));
        jPanelMedia.setMinimumSize(new java.awt.Dimension(0, 0));
        jPanelMedia.setPreferredSize(new java.awt.Dimension(0, 300));
        jPanelMedia.setRequestFocusEnabled(false);
        jPanelMedia.setLayout(new java.awt.BorderLayout());

        jList1.setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);
        jScrollPane1.setViewportView(jList1);

        jPanelMedia.add(jScrollPane1, java.awt.BorderLayout.CENTER);

        add(jPanelMedia);

        jPanelSupportText.setBorder(javax.swing.BorderFactory.createEmptyBorder(3, 3, 10, 3));
        jPanelSupportText.setToolTipText(null);
        jPanelSupportText.setMinimumSize(new java.awt.Dimension(0, 50));
        jPanelSupportText.setPreferredSize(new java.awt.Dimension(0, 50));
        jPanelSupportText.setLayout(new java.awt.BorderLayout());

        jPanel4.setOpaque(false);
        jPanel4.setLayout(new java.awt.GridBagLayout());

        jLabel7.setBackground(new java.awt.Color(153, 255, 255));
        jLabel7.setFont(new java.awt.Font(".SF NS Text", 1, 12)); // NOI18N
        jLabel7.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        java.util.ResourceBundle bundle = java.util.ResourceBundle.getBundle("Strings"); // NOI18N
        jLabel7.setText(bundle.getString("label_hora")); // NOI18N
        jLabel7.setHorizontalTextPosition(javax.swing.SwingConstants.LEADING);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 20);
        jPanel4.add(jLabel7, gridBagConstraints);

        jLabelVALORHora.setBackground(new java.awt.Color(153, 255, 255));
        jLabelVALORHora.setFont(new java.awt.Font(".SF NS Text", 0, 12)); // NOI18N
        jLabelVALORHora.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        jLabelVALORHora.setText("hh:mm");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        jPanel4.add(jLabelVALORHora, gridBagConstraints);

        jLabel5.setBackground(new java.awt.Color(153, 255, 255));
        jLabel5.setFont(new java.awt.Font(".SF NS Text", 1, 12)); // NOI18N
        jLabel5.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        jLabel5.setText(bundle.getString("label_dependiente")); // NOI18N
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 20);
        jPanel4.add(jLabel5, gridBagConstraints);

        jLabelVALORUsuario.setBackground(new java.awt.Color(153, 255, 255));
        jLabelVALORUsuario.setFont(new java.awt.Font(".SF NS Text", 0, 12)); // NOI18N
        jLabelVALORUsuario.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        jLabelVALORUsuario.setText("Nombre Apellido");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 1;
        jPanel4.add(jLabelVALORUsuario, gridBagConstraints);

        jLabel2.setBackground(new java.awt.Color(153, 255, 255));
        jLabel2.setFont(jLabel2.getFont().deriveFont(jLabel2.getFont().getStyle() | java.awt.Font.BOLD, jLabel2.getFont().getSize()+5));
        jLabel2.setText("Total: ");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 20);
        jPanel4.add(jLabel2, gridBagConstraints);

        jLabelVALORTotal.setBackground(new java.awt.Color(153, 255, 255));
        jLabelVALORTotal.setFont(jLabelVALORTotal.getFont().deriveFont(jLabelVALORTotal.getFont().getStyle() | java.awt.Font.BOLD, jLabelVALORTotal.getFont().getSize()+5));
        jLabelVALORTotal.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabelVALORTotal.setText("0.00 CUC");
        jLabelVALORTotal.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(0, 0, 0), 1, true));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        jPanel4.add(jLabelVALORTotal, gridBagConstraints);

        jPanelSupportText.add(jPanel4, java.awt.BorderLayout.PAGE_START);

        add(jPanelSupportText);

        jPanelActionButtons.setBorder(javax.swing.BorderFactory.createEmptyBorder(10, 10, 10, 10));
        jPanelActionButtons.setToolTipText(null);
        jPanelActionButtons.setMaximumSize(new java.awt.Dimension(32767, 50));
        jPanelActionButtons.setMinimumSize(new java.awt.Dimension(0, 25));
        jPanelActionButtons.setPreferredSize(new java.awt.Dimension(0, 50));
        jPanelActionButtons.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.RIGHT));

        jideButtonEnviarCocina.setBackground(new java.awt.Color(204, 204, 204));
        jideButtonEnviarCocina.setText("Cocina");
        jideButtonEnviarCocina.setToolTipText("Enviar a cocina");
        jideButtonEnviarCocina.setBorderPainted(false);
        jideButtonEnviarCocina.setFocusable(false);
        jPanelActionButtons.add(jideButtonEnviarCocina);

        jideButtonCerrarMesa.setBackground(new java.awt.Color(204, 204, 204));
        jideButtonCerrarMesa.setText("Cerrar");
        jideButtonCerrarMesa.setToolTipText("Cobrar orden");
        jideButtonCerrarMesa.setBorderPainted(false);
        jideButtonCerrarMesa.setFocusable(false);
        jPanelActionButtons.add(jideButtonCerrarMesa);

        add(jPanelActionButtons);
    }// </editor-fold>//GEN-END:initComponents

    private void jButtonMenuActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonMenuActionPerformed
        createPopupPanel();
    }//GEN-LAST:event_jButtonMenuActionPerformed

    public String getTitle() {
        return title;
    }

    public String getSecondaryText() {
        return secondaryText;
    }

    public String getSupportText() {
        return supportText;
    }

    public JLabel getjLabelCardTitle() {
        return jLabelOrdenNo;
    }

    public void setSecondaryTextColor(Color color) {
        jLabelMesa.setForeground(color);
    }

    private void setMenuUI() {
        jPanelSubActions = new org.jdesktop.swingx.JXTaskPaneContainer();
        jPopupMenu1 = new javax.swing.JPopupMenu();

        org.jdesktop.swingx.VerticalLayout verticalLayout1 = new org.jdesktop.swingx.VerticalLayout();
        verticalLayout1.setGap(14);
        jPanelSubActions.setLayout(verticalLayout1);
    }

    private org.jdesktop.swingx.JXTaskPaneContainer jPanelSubActions;
    private javax.swing.JPopupMenu jPopupMenu1;
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jButtonMenu;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabelGratis;
    private javax.swing.JLabel jLabelMesa;
    private javax.swing.JLabel jLabelOrdenNo;
    private javax.swing.JLabel jLabelPorciento;
    private javax.swing.JLabel jLabelTerminada;
    private javax.swing.JLabel jLabelVALORHora;
    private javax.swing.JLabel jLabelVALORTotal;
    private javax.swing.JLabel jLabelVALORUsuario;
    private javax.swing.JList<ProductovOrden> jList1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanelActionButtons;
    private javax.swing.JPanel jPanelEstado;
    private javax.swing.JPanel jPanelHeader;
    private javax.swing.JPanel jPanelMedia;
    private javax.swing.JPanel jPanelMenu;
    private javax.swing.JPanel jPanelSupportText;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JToggleButton jToggleButtonExpand;
    private javax.swing.JButton jideButtonCerrarMesa;
    private javax.swing.JButton jideButtonEnviarCocina;
    // End of variables declaration//GEN-END:variables

    private Component addMenuItem(Action action) {
        Component c = jPanelSubActions.add(buildFromAction(action));
        jPopupMenu1.add(action);
        return c;
    }

    private Component buildFromAction(Action a) {
        return new TaskButton(a, jPanelSubActions.getWidth());
    }

    private void createPopupPanel() {
        jPopupMenu1.show(jButtonMenu, jButtonMenu.getBounds().x - jPopupMenu1.getWidth(), jButtonMenu.getBounds().y + jButtonMenu.getHeight());
        jPopupMenu1.show(jButtonMenu, jButtonMenu.getBounds().x - jPopupMenu1.getWidth(), jButtonMenu.getBounds().y + jButtonMenu.getHeight());
    }

    public ImageIcon circlarShape(String image) {

        try {
            BufferedImage master = ImageIO.read(new File(image));

            int diameter = Math.min(master.getWidth(), master.getHeight());
            BufferedImage mask = new BufferedImage(master.getWidth(), master.getHeight(), BufferedImage.TYPE_INT_ARGB);

            Graphics2D g2d = mask.createGraphics();
            applyQualityRenderingHints(g2d);
            g2d.fillOval(0, 0, diameter - 1, diameter - 1);
            g2d.dispose();

            BufferedImage masked = new BufferedImage(diameter, diameter, BufferedImage.TYPE_INT_ARGB);
            g2d = masked.createGraphics();
            applyQualityRenderingHints(g2d);
            int x = (diameter - master.getWidth()) / 2;
            int y = (diameter - master.getHeight()) / 2;
            g2d.drawImage(master, x, y, null);
            g2d.setComposite(AlphaComposite.getInstance(AlphaComposite.DST_IN));
            g2d.drawImage(mask, 0, 0, null);
            g2d.dispose();

            return new ImageIcon(masked);
        } catch (IOException ex) {
            Logger.getLogger(PedidoCardView.class.getName()).log(Level.SEVERE, null, ex);
        }
        return null;
    }

    public static void applyQualityRenderingHints(Graphics2D g2d) {

        g2d.setRenderingHint(RenderingHints.KEY_ALPHA_INTERPOLATION, RenderingHints.VALUE_ALPHA_INTERPOLATION_QUALITY);
        g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);
        g2d.setRenderingHint(RenderingHints.KEY_COLOR_RENDERING, RenderingHints.VALUE_COLOR_RENDER_QUALITY);
        g2d.setRenderingHint(RenderingHints.KEY_DITHERING, RenderingHints.VALUE_DITHER_ENABLE);
        g2d.setRenderingHint(RenderingHints.KEY_FRACTIONALMETRICS, RenderingHints.VALUE_FRACTIONALMETRICS_ON);
        g2d.setRenderingHint(RenderingHints.KEY_INTERPOLATION, RenderingHints.VALUE_INTERPOLATION_BILINEAR);
        g2d.setRenderingHint(RenderingHints.KEY_RENDERING, RenderingHints.VALUE_RENDER_QUALITY);
        g2d.setRenderingHint(RenderingHints.KEY_STROKE_CONTROL, RenderingHints.VALUE_STROKE_PURE);

    }

    @Override
    public void wireUp() {
        Bindings.bind(jLabelOrdenNo, getPresenter().getModel(PROP_ID_ORDEN));
        Bindings.bind(jLabelMesa, getPresenter().getModel(PROP_MESA_PEDIDO));
        Bindings.bind(jLabelVALORHora, getPresenter().getModel(PROP_HORA_PEDIDO));
        Bindings.bind(jLabelVALORTotal, getPresenter().getModel(PROP_TOTAL_ORDEN));
        Bindings.bind(jLabelVALORUsuario, getPresenter().getModel(PROP_USUARIO));
        Bindings.bind(jLabelGratis, "visible", getPresenter().getModel(PROP_ES_AUTORIZO));
        Bindings.bind(jLabelPorciento, "visible", getPresenter().getModel(PROP_TIENE_PORCIENTO));
        Bindings.bind(jLabelTerminada, "visible", getPresenter().getModel(PROP_ORDEN_TERMINADA));

        jideButtonCerrarMesa.addActionListener(getPresenter().getOperation(ACTION_CERRAR_ORDEN));
        jideButtonEnviarCocina.addActionListener(getPresenter().getOperation(ACTION_ENVIAR_ELABORAR));

        jPanelSubActions.add(addMenuItem(getPresenter().getOperation(ACTION_ADD_NOTA)));
        jPanelSubActions.add(addMenuItem(getPresenter().getOperation(ACTION_IMPRIMIR_CIERRE_PARCIAL)));
        jPanelSubActions.add(addMenuItem(getPresenter().getOperation(ACTION_SET_AUTORIZO)));
        jPanelSubActions.add(addMenuItem(getPresenter().getOperation(ACTION_SET_PORCIENTO)));
        jPanelSubActions.add(addMenuItem(getPresenter().getOperation(ACTION_ADD_PRODUCTO)));
        jPanelSubActions.add(addMenuItem(getPresenter().getOperation(ACTION_REMOVE_PRODUCTO)));

        jToggleButtonExpand.addActionListener((ActionEvent e) -> {
            jPanelMedia.setVisible(jToggleButtonExpand.isSelected());
        });

        Bindings.bind(jList1, new SelectionInList<ProductovOrden>(
                getPresenter().getModel(PROP_LISTA_PRODUCTO_ORDEN),
                getPresenter().getModel(PROP_PRODUCTO_ORDEN_SELECCIONADO)));

    }

    @Override
    public void uiInit() {
        initComponents();
        setMenuUI();
        jList1 = new JList() {
            //Subclass JList to workaround bug 4832765, which can cause the
            //scroll pane to not let the user easily scroll up to the beginning
            //of the list.  An alternative would be to set the unitIncrement
            //of the JScrollBar to a fixed value. You wouldn't get the nice
            //aligned scrolling, but it should work.
            @Override
            public int getScrollableUnitIncrement(Rectangle visibleRect,
                    int orientation,
                    int direction) {
                int row;
                if (orientation == SwingConstants.VERTICAL
                        && direction < 0 && (row = getFirstVisibleIndex()) != -1) {
                    Rectangle r = getCellBounds(row, row);
                    if ((r.y == visibleRect.y) && (row != 0)) {
                        Point loc = r.getLocation();
                        loc.y--;
                        int prevIndex = locationToIndex(loc);
                        Rectangle prevR = getCellBounds(prevIndex, prevIndex);

                        if (prevR == null || prevR.y >= r.y) {
                            return 0;
                        }
                        return prevR.height;
                    }
                }
                return super.getScrollableUnitIncrement(
                        visibleRect, orientation, direction);
            }

        };
        jList1.setCellRenderer(new ListCellRenderPedido());

    }

    @Override
    public String getViewName() {
        return "PedidoCard";
    }
}
