/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package com.jobits.pos.ui.almacen.ipv;

import com.jgoodies.binding.adapter.Bindings;
import com.jgoodies.binding.list.SelectionInList;
import com.jobits.pos.ui.utils.RestManagerCellRender;
import java.awt.Font;
import java.awt.print.PrinterException;
import java.text.MessageFormat;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JTable;
import com.jobits.pos.core.domain.models.Cocina;
import com.jobits.pos.core.domain.models.Insumo;
import com.jobits.pos.core.domain.models.IpvRegistro;
import com.jobits.pos.core.domain.models.IpvVentaRegistro;
import com.jobits.pos.recursos.R;
import com.jobits.pos.ui.AbstractViewPanel;
import static com.jobits.pos.ui.almacen.ipv.presenter.IpvGestionViewModel.*;
import com.jobits.pos.ui.almacen.ipv.presenter.IpvGestionViewPresenter;
import com.jobits.pos.ui.presenters.AbstractViewPresenter;
import com.jobits.pos.ui.swing.utils.BindableListIntelliHint;
import com.jobits.pos.ui.swing.utils.BindableTableModel;
import com.jobits.pos.utils.utils;
import com.jobits.ui.components.MaterialComponentsFactory;
import com.root101.swing.material.standards.MaterialIcons;
import java.beans.PropertyChangeEvent;

/**
 *
 * @author Jorge
 */
public class IpvGestionView extends AbstractViewPanel {

    public static final String VIEW_NAME = "IPV";

    public IpvGestionView(AbstractViewPresenter presenter) {
        super(presenter);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanelOpciones = MaterialComponentsFactory.Containers.getPrimaryPanel();
        jPanel8 = MaterialComponentsFactory.Containers.getTransparentPanel();
        jComboBoxPtoElabSelec = MaterialComponentsFactory.Displayers.getComboBox("Punto Elaboracion");
        jButtonRefrescar = MaterialComponentsFactory.Buttons.getOutlinedButton();
        jPanel3 = MaterialComponentsFactory.Containers.getSecondaryPanel();
        jTabbedPane2 = new javax.swing.JTabbedPane();
        jPanelRegistros = MaterialComponentsFactory.Containers.getSecondaryPanel();
        jPanel4 = MaterialComponentsFactory.Containers.getTransparentPanel();
        jToggleButtonIpv = new javax.swing.JToggleButton();
        jDateChooserIpv = MaterialComponentsFactory.Input.getDatePicker();
        jPanel9 = MaterialComponentsFactory.Containers.getTransparentPanel();
        jTextFieldInsumos = MaterialComponentsFactory.Input.getTextField("Buscar...", "");
        jButtonAgregarInsumo = MaterialComponentsFactory.Buttons.getAddButton();
        jPanel2 = MaterialComponentsFactory.Containers.getTransparentPanel();
        jScrollPane2 = MaterialComponentsFactory.Containers.getScrollPane();
        jTableRegistro = new javax.swing.JTable();
        jPanel1 = MaterialComponentsFactory.Containers.getPrimaryPanel();
        jPanel11 = MaterialComponentsFactory.Containers.getTransparentPanel();
        jPanel10 = MaterialComponentsFactory.Containers.getTransparentPanel();
        jButtonimprimirIpvRegistro = MaterialComponentsFactory.Buttons.getLinedButton();
        jButtonDarEntradaIpv = MaterialComponentsFactory.Buttons.getLinedButton();
        jButtonEnviarToIPV = MaterialComponentsFactory.Buttons.getLinedButton();
        jButtonEnviarToAlmacen = MaterialComponentsFactory.Buttons.getLinedButton();
        jButtonAjustarConsumo = MaterialComponentsFactory.Buttons.getLinedButton();
        jButtonAjustarCosto = MaterialComponentsFactory.Buttons.getLinedButton();
        jButtonEliminarIPV = MaterialComponentsFactory.Buttons.getLinedButton();
        jPanel12 = MaterialComponentsFactory.Containers.getTransparentPanel();
        jLabel1 = new javax.swing.JLabel();
        jLabelTotalIpvRegistro = new javax.swing.JLabel();
        jPanelIPV = MaterialComponentsFactory.Containers.getSecondaryPanel();
        jPanel7 = MaterialComponentsFactory.Containers.getTransparentPanel();
        jToggleButtonIpvVenta = new javax.swing.JToggleButton();
        jDateChooserIpvVentas = MaterialComponentsFactory.Input.getDatePicker();
        jPanel5 = MaterialComponentsFactory.Containers.getTransparentPanel();
        jScrollPane4 = MaterialComponentsFactory.Containers.getScrollPane();
        jTableIPV = new javax.swing.JTable();
        jPanel6 = MaterialComponentsFactory.Containers.getPrimaryPanel();
        jButtonImprimirIpv = MaterialComponentsFactory.Buttons.getLinedButton();
        jButtonDarEntradaIpvVenta = MaterialComponentsFactory.Buttons.getLinedButton();
        jButtonPedido = MaterialComponentsFactory.Buttons.getLinedButton();

        setOpaque(false);
        setLayout(new java.awt.BorderLayout());

        jPanelOpciones.setPreferredSize(new java.awt.Dimension(250, 60));
        jPanelOpciones.setLayout(new java.awt.BorderLayout());

        jPanel8.setBorder(javax.swing.BorderFactory.createEmptyBorder(10, 1, 10, 10));
        jPanel8.setLayout(new java.awt.BorderLayout());

        jComboBoxPtoElabSelec.setFont(new java.awt.Font("Dialog", 1, 14)); // NOI18N
        jComboBoxPtoElabSelec.setBorder(javax.swing.BorderFactory.createEmptyBorder(5, 5, 5, 5));
        jComboBoxPtoElabSelec.setMinimumSize(new java.awt.Dimension(150, 70));
        jComboBoxPtoElabSelec.setOpaque(false);
        jComboBoxPtoElabSelec.setPreferredSize(new java.awt.Dimension(250, 50));
        jPanel8.add(jComboBoxPtoElabSelec, java.awt.BorderLayout.CENTER);

        jButtonRefrescar.setIcon(MaterialIcons.REFRESH);
        jButtonRefrescar.setPreferredSize(new java.awt.Dimension(40, 40));
        jPanel8.add(jButtonRefrescar, java.awt.BorderLayout.EAST);

        jPanelOpciones.add(jPanel8, java.awt.BorderLayout.EAST);

        add(jPanelOpciones, java.awt.BorderLayout.PAGE_START);

        jPanel3.setBorder(javax.swing.BorderFactory.createEmptyBorder(15, 15, 15, 15));
        jPanel3.setLayout(new java.awt.BorderLayout());

        jTabbedPane2.setOpaque(true);

        jPanelRegistros.setLayout(new java.awt.BorderLayout(5, 0));

        jPanel4.setBorder(javax.swing.BorderFactory.createEmptyBorder(5, 15, 5, 15));
        jPanel4.setLayout(new java.awt.BorderLayout());

        java.util.ResourceBundle bundle = java.util.ResourceBundle.getBundle("Strings"); // NOI18N
        jToggleButtonIpv.setText(bundle.getString("label_ocultar_insumos_no_utilizados")); // NOI18N
        jPanel4.add(jToggleButtonIpv, java.awt.BorderLayout.WEST);

        jDateChooserIpv.setBorder(javax.swing.BorderFactory.createEmptyBorder(1, 10, 1, 1));
        jDateChooserIpv.setPreferredSize(new java.awt.Dimension(170, 40));
        jPanel4.add(jDateChooserIpv, java.awt.BorderLayout.LINE_END);

        jTextFieldInsumos.setMinimumSize(new java.awt.Dimension(250, 26));
        jTextFieldInsumos.setPreferredSize(new java.awt.Dimension(200, 50));
        jPanel9.add(jTextFieldInsumos);

        jButtonAgregarInsumo.setFont(new java.awt.Font("Lucida Grande", 0, 14)); // NOI18N
        jButtonAgregarInsumo.setText("Registrar");
        jButtonAgregarInsumo.setMaximumSize(new java.awt.Dimension(130, 50));
        jButtonAgregarInsumo.setPreferredSize(new java.awt.Dimension(130, 50));
        jPanel9.add(jButtonAgregarInsumo);

        jPanel4.add(jPanel9, java.awt.BorderLayout.CENTER);

        jPanelRegistros.add(jPanel4, java.awt.BorderLayout.PAGE_START);

        jPanel2.setBorder(javax.swing.BorderFactory.createEmptyBorder(1, 15, 1, 15));
        jPanel2.setOpaque(false);
        jPanel2.setLayout(new java.awt.BorderLayout());

        jScrollPane2.setVerticalScrollBarPolicy(javax.swing.ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS);

        jTableRegistro.setAutoCreateRowSorter(true);
        jTableRegistro.setFont(new java.awt.Font("Lucida Grande", 0, 22)); // NOI18N
        jTableRegistro.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {

            }
        ));
        jTableRegistro.setRowHeight(25);
        jTableRegistro.setRowMargin(4);
        jScrollPane2.setViewportView(jTableRegistro);

        jPanel2.add(jScrollPane2, java.awt.BorderLayout.CENTER);

        jPanelRegistros.add(jPanel2, java.awt.BorderLayout.CENTER);

        jPanel1.setPreferredSize(new java.awt.Dimension(329, 60));
        jPanel1.setLayout(new java.awt.BorderLayout());

        jPanel11.setPreferredSize(new java.awt.Dimension(200, 100));
        jPanel1.add(jPanel11, java.awt.BorderLayout.WEST);

        jPanel10.setLayout(new java.awt.GridBagLayout());

        jButtonimprimirIpvRegistro.setIcon(new javax.swing.ImageIcon(getClass().getResource("/restManager/resources/icons pack/imprimir_detallado_indigo.png"))); // NOI18N
        jButtonimprimirIpvRegistro.setMnemonic('i');
        jButtonimprimirIpvRegistro.setToolTipText("Imprimir");
        jButtonimprimirIpvRegistro.setBorderPainted(false);
        jButtonimprimirIpvRegistro.setPreferredSize(new java.awt.Dimension(80, 50));
        jPanel10.add(jButtonimprimirIpvRegistro, new java.awt.GridBagConstraints());

        jButtonDarEntradaIpv.setIcon(new javax.swing.ImageIcon(getClass().getResource("/restManager/resources/icons pack/entrada_detallado_indigo.png"))); // NOI18N
        jButtonDarEntradaIpv.setMnemonic('e');
        jButtonDarEntradaIpv.setToolTipText(bundle.getString("label_dar_entada")); // NOI18N
        jButtonDarEntradaIpv.setBorderPainted(false);
        jButtonDarEntradaIpv.setPreferredSize(new java.awt.Dimension(80, 50));
        jPanel10.add(jButtonDarEntradaIpv, new java.awt.GridBagConstraints());

        jButtonEnviarToIPV.setIcon(new javax.swing.ImageIcon(getClass().getResource("/restManager/resources/icons pack/enviar_cocina_indigo.png"))); // NOI18N
        jButtonEnviarToIPV.setMnemonic('c');
        jButtonEnviarToIPV.setToolTipText("Enviar a IPV");
        jButtonEnviarToIPV.setBorderPainted(false);
        jButtonEnviarToIPV.setPreferredSize(new java.awt.Dimension(80, 50));
        jPanel10.add(jButtonEnviarToIPV, new java.awt.GridBagConstraints());

        jButtonEnviarToAlmacen.setIcon(new javax.swing.ImageIcon(getClass().getResource("/restManager/resources/icons pack/enviar_almacen_indigo.png"))); // NOI18N
        jButtonEnviarToAlmacen.setMnemonic('c');
        jButtonEnviarToAlmacen.setToolTipText("Enviar a Almacen");
        jButtonEnviarToAlmacen.setBorderPainted(false);
        jButtonEnviarToAlmacen.setPreferredSize(new java.awt.Dimension(80, 50));
        jPanel10.add(jButtonEnviarToAlmacen, new java.awt.GridBagConstraints());

        jButtonAjustarConsumo.setIcon(new javax.swing.ImageIcon(getClass().getResource("/restManager/resources/icons pack/estadisticas_indigo.png"))); // NOI18N
        jButtonAjustarConsumo.setMnemonic('a');
        jButtonAjustarConsumo.setToolTipText(bundle.getString("label_ajustar_consumo")); // NOI18N
        jButtonAjustarConsumo.setBorderPainted(false);
        jButtonAjustarConsumo.setPreferredSize(new java.awt.Dimension(80, 50));
        jPanel10.add(jButtonAjustarConsumo, new java.awt.GridBagConstraints());

        jButtonAjustarCosto.setIcon(new javax.swing.ImageIcon(getClass().getResource("/restManager/resources/icons pack/valor_indigo.png"))); // NOI18N
        jButtonAjustarCosto.setToolTipText("Ajustar Costo");
        jButtonAjustarCosto.setBorderPainted(false);
        jButtonAjustarCosto.setPreferredSize(new java.awt.Dimension(80, 50));
        jPanel10.add(jButtonAjustarCosto, new java.awt.GridBagConstraints());

        jButtonEliminarIPV.setIcon(new javax.swing.ImageIcon(getClass().getResource("/restManager/resources/icons pack/eliminar_indigo.png"))); // NOI18N
        jButtonEliminarIPV.setToolTipText("Eliminar IPV");
        jButtonEliminarIPV.setBorderPainted(false);
        jButtonEliminarIPV.setPreferredSize(new java.awt.Dimension(80, 50));
        jPanel10.add(jButtonEliminarIPV, new java.awt.GridBagConstraints());

        jPanel1.add(jPanel10, java.awt.BorderLayout.CENTER);

        jPanel12.setPreferredSize(new java.awt.Dimension(200, 100));
        jPanel12.setLayout(new java.awt.GridBagLayout());

        jLabel1.setFont(new java.awt.Font("Dialog", 1, 18)); // NOI18N
        jLabel1.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel1.setText("Total: ");
        jPanel12.add(jLabel1, new java.awt.GridBagConstraints());

        jLabelTotalIpvRegistro.setFont(new java.awt.Font("Dialog", 1, 18)); // NOI18N
        jLabelTotalIpvRegistro.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabelTotalIpvRegistro.setText("xx.xx MN");
        jPanel12.add(jLabelTotalIpvRegistro, new java.awt.GridBagConstraints());

        jPanel1.add(jPanel12, java.awt.BorderLayout.EAST);

        jPanelRegistros.add(jPanel1, java.awt.BorderLayout.PAGE_END);

        jTabbedPane2.addTab("Registros Existencias", new javax.swing.ImageIcon(getClass().getResource("/restManager/resources/images/registro_lapiz.png")), jPanelRegistros, "Ver los registros de IPvs"); // NOI18N

        jPanelIPV.setLayout(new java.awt.BorderLayout(5, 0));

        jPanel7.setBorder(javax.swing.BorderFactory.createEmptyBorder(5, 15, 5, 15));
        jPanel7.setLayout(new java.awt.BorderLayout());

        jToggleButtonIpvVenta.setText(bundle.getString("label_productos_no_utilizados")); // NOI18N
        jPanel7.add(jToggleButtonIpvVenta, java.awt.BorderLayout.WEST);

        jDateChooserIpvVentas.setBorder(javax.swing.BorderFactory.createEmptyBorder(1, 10, 1, 1));
        jDateChooserIpvVentas.setPreferredSize(new java.awt.Dimension(170, 40));
        jPanel7.add(jDateChooserIpvVentas, java.awt.BorderLayout.LINE_END);

        jPanelIPV.add(jPanel7, java.awt.BorderLayout.PAGE_START);

        jPanel5.setBorder(javax.swing.BorderFactory.createEmptyBorder(1, 15, 1, 15));
        jPanel5.setLayout(new java.awt.BorderLayout());

        jScrollPane4.setVerticalScrollBarPolicy(javax.swing.ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS);

        jTableIPV.setAutoCreateRowSorter(true);
        jTableIPV.setFont(new java.awt.Font("Lucida Grande", 0, 22)); // NOI18N
        jTableIPV.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Producto Venta", "Inicio", "Entrada", "Disponible", "Autorizo", "Venta", "Precio Venta", "Importe", "Final"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.Object.class, java.lang.Float.class, java.lang.Float.class, java.lang.Float.class, java.lang.Float.class, java.lang.Float.class, java.lang.Float.class, java.lang.String.class, java.lang.Float.class
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }
        });
        jTableIPV.setRowHeight(35);
        jTableIPV.setRowMargin(5);
        jScrollPane4.setViewportView(jTableIPV);

        jPanel5.add(jScrollPane4, java.awt.BorderLayout.CENTER);

        jPanelIPV.add(jPanel5, java.awt.BorderLayout.CENTER);

        jPanel6.setMinimumSize(new java.awt.Dimension(207, 58));
        jPanel6.setPreferredSize(new java.awt.Dimension(329, 60));
        jPanel6.setLayout(new java.awt.GridBagLayout());

        jButtonImprimirIpv.setIcon(new javax.swing.ImageIcon(getClass().getResource("/restManager/resources/icons pack/imprimir_detallado_indigo.png"))); // NOI18N
        jButtonImprimirIpv.setMnemonic('i');
        jButtonImprimirIpv.setToolTipText("Imprimir");
        jButtonImprimirIpv.setBorderPainted(false);
        jButtonImprimirIpv.setPreferredSize(new java.awt.Dimension(80, 50));
        jPanel6.add(jButtonImprimirIpv, new java.awt.GridBagConstraints());

        jButtonDarEntradaIpvVenta.setIcon(new javax.swing.ImageIcon(getClass().getResource("/restManager/resources/icons pack/entrada_detallado_indigo.png"))); // NOI18N
        jButtonDarEntradaIpvVenta.setMnemonic('e');
        jButtonDarEntradaIpvVenta.setToolTipText(bundle.getString("label_dar_entada")); // NOI18N
        jButtonDarEntradaIpvVenta.setBorderPainted(false);
        jButtonDarEntradaIpvVenta.setPreferredSize(new java.awt.Dimension(80, 50));
        jPanel6.add(jButtonDarEntradaIpvVenta, new java.awt.GridBagConstraints());

        jButtonPedido.setIcon(new javax.swing.ImageIcon(getClass().getResource("/restManager/resources/icons pack/flechas_indigo.png"))); // NOI18N
        jButtonPedido.setMnemonic('a');
        jButtonPedido.setToolTipText(bundle.getString("label_pedido")); // NOI18N
        jButtonPedido.setBorderPainted(false);
        jButtonPedido.setPreferredSize(new java.awt.Dimension(80, 50));
        jPanel6.add(jButtonPedido, new java.awt.GridBagConstraints());

        jPanelIPV.add(jPanel6, java.awt.BorderLayout.PAGE_END);

        jTabbedPane2.addTab("IPV", jPanelIPV);

        jPanel3.add(jTabbedPane2, java.awt.BorderLayout.CENTER);

        add(jPanel3, java.awt.BorderLayout.CENTER);
    }// </editor-fold>//GEN-END:initComponents

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jButtonAgregarInsumo;
    private javax.swing.JButton jButtonAjustarConsumo;
    private javax.swing.JButton jButtonAjustarCosto;
    private javax.swing.JButton jButtonDarEntradaIpv;
    private javax.swing.JButton jButtonDarEntradaIpvVenta;
    private javax.swing.JButton jButtonEliminarIPV;
    private javax.swing.JButton jButtonEnviarToAlmacen;
    private javax.swing.JButton jButtonEnviarToIPV;
    private javax.swing.JButton jButtonImprimirIpv;
    private javax.swing.JButton jButtonPedido;
    private javax.swing.JButton jButtonRefrescar;
    private javax.swing.JButton jButtonimprimirIpvRegistro;
    private javax.swing.JComboBox<Cocina> jComboBoxPtoElabSelec;
    private org.jdesktop.swingx.JXDatePicker jDateChooserIpv;
    private org.jdesktop.swingx.JXDatePicker jDateChooserIpvVentas;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabelTotalIpvRegistro;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel10;
    private javax.swing.JPanel jPanel11;
    private javax.swing.JPanel jPanel12;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JPanel jPanel6;
    private javax.swing.JPanel jPanel7;
    private javax.swing.JPanel jPanel8;
    private javax.swing.JPanel jPanel9;
    private javax.swing.JPanel jPanelIPV;
    private javax.swing.JPanel jPanelOpciones;
    private javax.swing.JPanel jPanelRegistros;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane4;
    private javax.swing.JTabbedPane jTabbedPane2;
    private javax.swing.JTable jTableIPV;
    private javax.swing.JTable jTableRegistro;
    private javax.swing.JTextField jTextFieldInsumos;
    private javax.swing.JToggleButton jToggleButtonIpv;
    private javax.swing.JToggleButton jToggleButtonIpvVenta;
    // End of variables declaration//GEN-END:variables

    @Override
    public void wireUp() {
        Bindings.bind(jToggleButtonIpv, getPresenter().getModel(PROP_CHECK_OCULTAR_PRODUCTOS));
        Bindings.bind(jLabelTotalIpvRegistro, getPresenter().getModel(PROP_TOTAL_IPV_REGISTRO));
        Bindings.bind(jToggleButtonIpvVenta, getPresenter().getModel(PROP_CHECK_OCULTAR_PRODUCTOS_IPV_VENTA));
        Bindings.bind(jComboBoxPtoElabSelec, new SelectionInList<Cocina>(
                getPresenter().getModel(PROP_LISTA_PUNTO_ELABORACION),
                getPresenter().getModel(PROP_PUNTO_ELABORACION_SELECCIONADO)),
                "Punto ElaboraciÃ³n");
        Bindings.bind(jDateChooserIpv, "date", getPresenter().getModel(PROP_FECHA_SELECCIONADA));
        Bindings.bind(jDateChooserIpvVentas, "date", getPresenter().getModel(PROP_FECHA_IPV_VENTAS_SELECCIONADA));

        Bindings.bind(jTableRegistro, new SelectionInList(
                getPresenter().getModel(PROP_LISTA_IPV_REGISTRO),
                getPresenter().getModel(PROP_IPV_REGISTRO_SELECICONADO)));
        Bindings.bind(jTableIPV, new SelectionInList(
                getPresenter().getModel(PROP_LISTA_IPV_VENTA_REGISTRO),
                getPresenter().getModel(PROP_IPV_VENTA_REGISTRO_SELECCIONADO)));
        jButtonAjustarConsumo.addActionListener(getPresenter().getOperation(IpvGestionViewPresenter.ACTION_AJUSTAR_IPV));
        jButtonDarEntradaIpv.addActionListener(getPresenter().getOperation(IpvGestionViewPresenter.ACTION_DAR_ENTRADA_IPV_REGISTROS));
        jButtonDarEntradaIpvVenta.addActionListener(getPresenter().getOperation(IpvGestionViewPresenter.ACTION_DAR_ENTRADA_IPV_VENTA));
        jButtonImprimirIpv.addActionListener(getPresenter().getOperation(IpvGestionViewPresenter.ACTION_IMPRIMIR_IPV_VENTA_REGISTRO));
        jButtonimprimirIpvRegistro.addActionListener(getPresenter().getOperation(IpvGestionViewPresenter.ACTION_IMPRIMIR_IPV_REGISTRO));
        jButtonPedido.addActionListener(getPresenter().getOperation(IpvGestionViewPresenter.ACTION_NUEVO_PEDIDO_IPV_VENTA));
//        jButtonimprimirIpv.addActionListener(getPresenter().getOperation(IpvGestionViewPresenter.ACTION_IMPRIMIR_IPV_VENTA_REGISTRO));
        jToggleButtonIpv.addActionListener(getPresenter().getOperation(IpvGestionViewPresenter.ACTION_OCULTAR_PRODUCTOS_IPV));
        jToggleButtonIpvVenta.addActionListener(getPresenter().getOperation(IpvGestionViewPresenter.ACTION_OCULTAR_PRODUCTOS_IPV_VENTA));
        jButtonRefrescar.addActionListener(getPresenter().getOperation(IpvGestionViewPresenter.ACTION_CAMBIAR_COCINA));
        jButtonEnviarToIPV.addActionListener(getPresenter().getOperation(IpvGestionViewPresenter.ACTION_ENVIAR_IPV_TO_IPV));
        jButtonEnviarToAlmacen.addActionListener(getPresenter().getOperation(IpvGestionViewPresenter.ACTION_ENVIAR_IPV_TO_ALMACEN));
        jButtonAgregarInsumo.addActionListener(getPresenter().getOperation(IpvGestionViewPresenter.ACTION_REGISTRAR_IPV_REGISTRO));
        jButtonAjustarCosto.addActionListener(getPresenter().getOperation(IpvGestionViewPresenter.ACTION_AJUSTAR_COSTO_IPV));
        jButtonEliminarIPV.addActionListener(getPresenter().getOperation(IpvGestionViewPresenter.ACTION_ELIMINAR_IPV_REGISTRO));

        getPresenter().addPropertyChangeListener("ImprimirTablaIPVVentaRegistro", (PropertyChangeEvent evt) -> {
            imprimirIPVVentaRegistro();
        });
        getPresenter().addPropertyChangeListener("ImprimirTablaIPVRegistro", (PropertyChangeEvent evt) -> {
            imprimirIPVRegistro();
        });

        BindableListIntelliHint<Insumo> autoCompleteModel = new BindableListIntelliHint(
                new SelectionInList<Insumo>(getPresenter().getModel(PROP_LISTA_INSUMOS),
                        getPresenter().getModel(PROP_INSUMO_SELECCIONADO)), jTextFieldInsumos);

    }

    @Override
    public void uiInit() {
        initComponents();
        jTableIPV.getTableHeader().setFont(jTableIPV.getFont().deriveFont(Font.BOLD));
        jTableIPV.setDefaultRenderer(Float.class, new RestManagerCellRender());
        jTableRegistro.getTableHeader().setFont(jTableIPV.getFont().deriveFont(Font.BOLD));
        jTableRegistro.setDefaultRenderer(Float.class, new RestManagerCellRender());

        //
        // tabla ipv ventas
        //
        jTableIPV.setModel(new BindableTableModel<IpvVentaRegistro>(jTableIPV) {
            @Override
            public int getColumnCount() {
                return 9;
            }

            @Override
            public Object getValueAt(int rowIndex, int columnIndex) {
                //TODO: calcular el total de la tabla y mostrarlo al final

//                if (rowIndex == getRowCount() - 1 && totalRowShowing) {
//                    if (columnIndex == 0) {
//                        return "Total";
//                    }
//                    if (columnIndex == columnTotal) {
//                        return utils.setDosLugaresDecimales(calcularTotal());
//                    }
//                    return null;
//                }
                if (getRowCount() > 0 && !totalRowShowing || getRowCount() > 1 && totalRowShowing) {
                    switch (columnIndex) {
                        case 0:
                            return getRow(rowIndex).getProductoVenta().getNombre();
                        case 1:
                            return getRow(rowIndex).getInicio();
                        case 2:
                            return getRow(rowIndex).getEntrada();
                        case 3:
                            return getRow(rowIndex).getDisponible();
                        case 4:
                            return getRow(rowIndex).getAutorizos();
                        case 5:
                            return getRow(rowIndex).getVenta();
                        case 6:
                            return getRow(rowIndex).getProductoVenta().getPrecioVenta();
                        case 7:
                            return utils.setDosLugaresDecimalesFloat(getRow(rowIndex).getVenta() * getRow(rowIndex).getProductoVenta().getPrecioVenta());
                        case 8:
                            return getRow(rowIndex).getFinal1();
                        default:
                            return null;
                    }
                }
                return null;
            }

            @Override
            public String getColumnName(int column) {
                switch (column) {
                    case 0:
                        return "Producto Venta";
                    case 1:
                        return "Inicio";
                    case 2:
                        return "Entrada";
                    case 3:
                        return "Disponible";
                    case 4:
                        return "Autorizo";
                    case 5:
                        return "Venta";
                    case 6:
                        return "Precio Venta (" + R.COIN_SUFFIX + ")";
                    case 7:
                        return "Importe (" + R.COIN_SUFFIX + ")";
                    case 8:
                        return "Final";
                    default:
                        return null;
                }
            }

            //TODO: calcular el total de la tabla y mostrarlo al final
//            @Override
//            protected float calcularTotal() {
//                float total = 0;
//                if (totalRowShowing) {
//                    for (IpvVentaRegistro i : items) {
//                        total += i.getVendidos() * i.getProductoVenta().getPrecioVenta();
//                    }
//                }
//                return total;
//           }
            @Override
            public Class<?> getColumnClass(int columnIndex) {
                switch (columnIndex) {
                    case 0:
                        return String.class;
                    default:
                        return Float.class;
                }
            }
        }
        );
        jTableIPV.getRowSorter().toggleSortOrder(0);
        jTableIPV.getColumnModel().getColumn(0).setPreferredWidth(250);
//  ((RestManagerAbstractTableModel<IpvVentaRegistro>) jTableIPV.getModel()).addTotalRow(7);

        //
        // Tabla Ipv
        //
        jTableRegistro.setModel(new BindableTableModel<IpvRegistro>(jTableRegistro) {
            @Override
            public int getColumnCount() {
                return 9;
            }

            @Override
            public Object getValueAt(int rowIndex, int columnIndex) {
                switch (columnIndex) {
                    case 0:
                        return getRow(rowIndex).getIpv().getInsumo().toString() + "(" + getRow(rowIndex).getPrecioCosto() + ")";
                    case 1:
                        return getRow(rowIndex).getInicio();
                    case 2:
                        return getRow(rowIndex).getEntrada();
                    case 3:
                        return getRow(rowIndex).getDisponible();
                    case 4:
                        return getRow(rowIndex).getConsumo();
                    case 5:
                        return getRow(rowIndex).getConsumoReal();
                    case 6:
                        return getRow(rowIndex).getFinal();
                    case 7:
                        return utils.setDosLugaresDecimalesFloat(
                                getRow(rowIndex).getFinal()
                                * getRow(rowIndex).getPrecioCosto());
                    case 8:
                        float consumo = getRow(rowIndex).getPrecioCosto() * getRow(rowIndex).getConsumo();
                        float consumoReal = getRow(rowIndex).getPrecioCosto() * getRow(rowIndex).getConsumoReal();

                        return utils.setDosLugaresDecimalesFloat(consumo - consumoReal);
                    default:
                        return null;
                }
            }

            @Override
            public String getColumnName(int column) {
                switch (column) {
                    case 0:
                        return "Insumo";
                    case 1:
                        return "Inicio";
                    case 2:
                        return "Entrada";
                    case 3:
                        return "Disponible";
                    case 4:
                        return "Consumo";
                    case 5:
                        return "Consumo Real";
                    case 6:
                        return "Final";
                    case 7:
                        return "Importe (" + R.COIN_SUFFIX + " )";
                    case 8:
                        return "Diferencia";
                    default:
                        return null;
                }
            }

            @Override
            public Class<?> getColumnClass(int columnIndex) {
                switch (columnIndex) {
                    case 1:
                        return Insumo.class;
                    default:
                        return Float.class;
                }
            }
        });
        jTableRegistro.getRowSorter().toggleSortOrder(0);
        jTableRegistro.getColumnModel().getColumn(0).setPreferredWidth(250);
    }

    @Override
    public String getViewName() {
        return VIEW_NAME;
    }

    private void imprimirIPVRegistro() {
        MessageFormat footer = new MessageFormat("-Pag {0}-");
        MessageFormat header = new MessageFormat("IPV " + jComboBoxPtoElabSelec.getSelectedItem().toString() + " Dia " + R.DATE_FORMAT.format(jDateChooserIpv.getDate()));
        try {
            jTableRegistro.print(JTable.PrintMode.FIT_WIDTH, header, footer);
        } catch (PrinterException ex) {
            Logger.getLogger(IpvGestionView.class
                    .getName()).log(Level.SEVERE, null, ex);
        }

    }

    private void imprimirIPVVentaRegistro() {
        MessageFormat footer = new MessageFormat("Entregado por                  Recibido por                  Revisado por");
        MessageFormat header = new MessageFormat("IPV " + jComboBoxPtoElabSelec.getSelectedItem().toString() + " Dia " + R.DATE_FORMAT.format(jDateChooserIpv.getDate()));
        try {
            jTableIPV.print(JTable.PrintMode.FIT_WIDTH, header, footer);
        } catch (PrinterException ex) {
            Logger.getLogger(IpvGestionView.class
                    .getName()).log(Level.SEVERE, null, ex);
        }

    }

}
